---
title: 'Reproducible Research: Peer Assessment 1'
output:
  html_document:
    keep_md: yes
  pdf_document: default
---

## Non standard R libs used
For the plots, I've used ggplot2 lib install.packages("ggplot2")
require(ggplot2)
TODO put this in code with control of is installed


## Loading and preprocessing the data
I've cloned the git repository https://github.com/rdpeng/RepData_PeerAssessment1 in the commit   80edf39c3bb508fee88e3394542f967dd3fd3270 with the data and instructions for this assignment.    
This cloned repository contains the data that I used in this assignment, it's a zip file called activity.zip that  
has inside a csv file called activity.csv, the following code extracts the activity.csv file from activity.zip.
```{r}
unzip("activity.zip")
```

I read the csv file to R and observed it's dimensions and summary

```{r}
activityDf <- read.csv("activity.csv")
dim(activityDf)
summary(activityDf)
```


## What is mean total number of steps taken per day?
Here I just ignored the missing values in the dataset, for that I created a new data.frame just with entries without NAs:  
```{r}
activityDfNoNa <- activityDf[!is.na(activityDf$steps), ]
```
Then I've made some work with the data without NAs.
```{r}
totalSteps <- sum(activityDfNoNa$steps)
totalDays <- length(levels(activityDf$date))
```
The indivitual of this experiment has taken `r totalSteps` steps during the `r totalDays` days that he was wearing his personal activity monitoring device.

I've calculated the sum of steps per day ignoring the days that have NA values, generated a histogram and calculated its mean and median:
```{r}
stepsPerDay <- tapply(activityDfNoNa$steps, activityDfNoNa$date, FUN = sum)
stepsPerDay <- stepsPerDay[!is.na(stepsPerDay)]
stepsPerDayMean <- format(round(mean(stepsPerDay), 2), nsmall = 2)
stepsPerDayMedian <- format(round(median(stepsPerDay), 2), nsmall = 2)
hist(stepsPerDay, ylab = "Sum of steps", xlab = "Days")
```


The mean of steps per day here is `r stepsPerDayMean` and the median is `r stepsPerDayMedian`

## What is the average daily activity pattern?
The get a view about the time interval patterns, I've calculated the average of steps during each time interval.  
You can see below the results of that with a time series plot:
```{r}
avgStepsPerInterval <- tapply(activityDfNoNa$steps, activityDfNoNa$interval, FUN = mean)
plot(y=avgStepsPerInterval, x= rownames(avgStepsPerInterval),type = "l", ylab = "Average Steps per Interval", xlab="5 min interval")
```

I've calculated the interval with the highest average of steps as well:
```{r}
maxAvgStepsPerInterval <- max(avgStepsPerInterval)
maxAvgStepsIntervalName <- names(avgStepsPerInterval[avgStepsPerInterval == maxAvgStepsPerInterval])
maxAvgStepsPerIntervalFormatted <- format(round(maxAvgStepsPerInterval, 2), nsmall = 2)
```
The interval with the biggest average of steps per day is `r maxAvgStepsIntervalName` with an average of `r maxAvgStepsPerIntervalFormatted` steps


## Imputing missing values
This data set came with some missing values for steps, bellow I've calculated how many rows have missing values on this data set:
```{r}
sapply(activityDf, function(x) sum(is.na(x)))
```

To fill in those missing values, I chose the general mean of that 5 minute interval.
```{r}
#colClasses <- sapply(activityDf, class)
#colNames <- colnames(activityDf)
#activityDfNaAvg <- data.frame() #read.table(text = "", colClasses = colClasses, col.names = colNames) 
#TODO debug this
 f <- function(x) {
   if(is.na(x["steps"])) {
     x["steps"] <- avgStepsPerInterval[names(avgStepsPerInterval) == x["interval"]]
   } 
   return(x)
 #avgStepsPerInterval[names(avgStepsPerInterval) == x["interval"]]   
 #x[1]
 #activityDf[is.na(activityDf$steps), ]   
 }
activityDfNaAvg <- apply(activityDf[1:15,], 1, f)


```
## Are there differences in activity patterns between weekdays and weekends?
